# 03. redux-toolkit

## 03-01. íˆ´í‚·ì„ ì„ íƒí•œ ì´ìœ 

ë¦¬ë•ìŠ¤ì—ì„œ ìì£¼ ì“°ëŠ” ê¸°ëŠ¥ë“¤ì„ ëª¨ì•„ ë‘” ë¼ì´ë¸ŒëŸ¬ë¦¬.

thunk, immer, createAction, createReducerë“±ë“± ë‚´ì¥ë˜ì–´ìˆë‹¤.



**package.json**<br/>(ë²„ì „ í™•ì¸ - ê°•ì˜ëŠ” react 17ë²„ì „ì´ìš©)

```json
{
  "name": "05.react-redux-toolkit",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "webpack serve --env development"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "react": "^18.1.0",
    "react-dom": "^18.1.0",
    "react-redux": "^8.0.5",
    "@reduxjs/toolkit": "^1.5.0"
  },
  "devDependencies": {
    "@babel/core": "^7.11.6",
    "@babel/preset-env": "^7.11.5",
    "@babel/preset-react": "^7.10.4",
    "@pmmmwh/react-refresh-webpack-plugin": "^0.5.7",
    "babel-loader": "^8.1.0",
    "react-refresh": "^0.13.0",
    "redux-devtools-extension": "^2.13.9",
    "webpack": "^5.3.2",
    "webpack-cli": "^4.1.0",
    "webpack-dev-server": "^4.0.0"
  }
}
```

**webpack.config.js**

Pluginê°€ì ¸ì™€ ë“±ë¡í•œ ê²ƒ í™•ì¸.

```javascript
const path = require('path');
const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');

module.exports = {
 ...
  module: {
    rules: [{
      test: /\.jsx?$/,
      loader: 'babel-loader',
      options: {
        presets: [
          ['@babel/preset-env', {
            targets: {browsers: ['last 2 chrome versions']},
            debug: true,
          }],
          '@babel/preset-react',
        ],
        plugins: ["react-refresh/babel"]
      },
      exclude: path.join(__dirname, 'node_modules'),
    }],
  },
  plugins: [
    new ReactRefreshWebpackPlugin(),
  ],
 ...
};
```

[ğŸ“˜ Redux Toolkit ê³µì‹ë¬¸ì„œ](https://redux-toolkit.js.org/)

`createSlice`ì™€ `createAsyncThunk`ê°€ ê°€ì¥ ë§ì´ ì‚¬ìš©ëœë‹¤.

â— ê³µì‹ë¬¸ì„œ ì½ì–´ë³´ì.



store.jsë¥¼ toolkitì„ ì´ìš©í•´ ìˆ˜ì •í•´ë³´ì

``` js
const {configureStore} = require('@reduxjs/toolkit');

const reducer = require('./reducers');
const {login, logout } = require('./actions/user');
const {addPost } = require('./actions/post');


const firstMiddleware = (store) => (dispatch) => (action) =>{
  console.log('ë¡œê¹…', action)
  // ê¸°ëŠ¥ ì¶”ê°€
  dispatch(action)
};

const store = configureStore(reducer, );

module.exports = store;
```

configureStoreì•ˆì— devtoolsë‚˜ thunk, initialState ë‹¤ ë“¤ì–´ê°€ìˆë‹¤.

```javasc
configureStore(reducer, preloadedState );
```

`preloadedState`ë¼ê³  ìˆëŠ”ë°, initialStateì™€ ë™ì¼í•œë°, SSRí•  ë•Œ ì„œë²„ì—ì„œ initialStateë¥¼ ë°›ëŠ” ê²½ìš°ì—ë§Œ ë„£ì–´ì£¼ë©´ ëœë‹¤.



```javascript
const store = configureStore({
  reducer, 
  // preloadedState 
  middleware: [firstMiddleware],
});
```

customí•œ middlewareë¥¼ ì €ë ‡ê²Œ ë„£ì„ ìˆ˜ ìˆëŠ”ë°, ì €ëŸ°ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë©´ toolkitì´ ê°€ì§€ê³ ìˆëŠ” thunkMiddlewareê°™ì€ê±´ ì œì™¸ëœë‹¤.

`getDefaultMiddleware()`ë¥¼ ê°€ì ¸ì™€ ê°™ì´ ì„ ì–¸í•´ì£¼ë©´ëœë‹¤.

```javascript
const store = configureStore({
  reducer, 
  // preloadedState 
  middleware: [firstMiddleware, ...getDefaultMiddleware()],
  devTools: process.env.NODE_ENV !== 'production',
});
```

enhancerëŠ” ìˆê¸´í•œë° ê±°ì˜ ì•ˆì”€.



## 03-02. ìƒˆë¡­ê²Œ ë“±ì¥í•œ slice

reducerë¶€ë¶„ì„ toolkitìœ¼ë¡œ ë°”ê¿”ë³´ì.

```javascript
// reducers/index.js
const {combineReducers} = require('redux');
// const userReducer = require('./user');
// const postReducer = require('./post');
const userSlice = require('./user');
const postSlice = require('./post');

module.exports = combineReducers({
  user: userSlice.reducer,
  posts: postSlice.reducer,
});
```

sliceëŠ” reducerë¿ë§Œ ì•„ë‹ˆë¼ action, ì´ˆê¸° stateë“±ë“± ì—¬ëŸ¬ê°€ì§€ê°€ ë“¤ì–´ìˆë‹¤.

ê±°ì˜ íŠ¹ì • actionì€ íŠ¹ì • reducerì— ì¢…ì†ë˜ìˆê¸° ë•Œë¬¸ì— í•©ì³ë†¨ë‹¤.

â— userì— sliceê°€ ì•„ë‹ˆë¼ sliceì•ˆì˜ reducerë¥¼ ë„£ì€ê²ƒ ì£¼ì˜!

ë¨¼ì €, postReducerë³€ê²½.

```javascript
const {createSlice} = require('@/reduxjs/toolkit')

const { ADD_POST } = require("../constant");

const initialState = {
  data:[],
};

const postSlice = createSlice({
  name: 'post',
  initialState, 
  reducers: {}, // ë™ê¸°ì 
  extraReducers:{}, // ë¹„ë™ê¸°ì 
})

module.exports = postSlice;
```

* `reducers`ëŠ” ë™ê¸°ì ì¸ actionì´ê±°ë‚˜ ë‚´ë¶€ì ì¸ action,
* `extraReducers`ëŠ” ë¹„ë™ê¸°ì ì¸ actionì´ê±°ë‚˜ ì™¸ë¶€ì ì¸ actionì´ë‹¤.



logoutì´ ë™ê¸°ì²˜ë¦¬ ëœë‹¤ ê°€ì •í•˜ê³  í•´ë³´ì.

```javascript
// reducers/user.js
const {createSlice} = require('@/reduxjs/toolkit')

const initialState = {
  isLoggingIn: false,
  data: null,
};
const userSlice = createSlice({
  name: 'user',
  initialState, 
  reducers: {
    logout(state, action){
      state.data = null;
    }
  }, // ë™ê¸°ì 
  extraReducers:{}, // ë¹„ë™ê¸°ì 
})

module.exports=userSlice;
```

toolkitì´ ì•Œì•„ì„œ ë§Œë“¤ì–´ ì¤˜ì„œ actionì´ í•„ìš”ì—†ì–´ì§€ê²Œ ëœë‹¤.

```javascript
// ì‚­ì œ
// const logout = () => {
//   return {
//     type: LOG_OUT,
//   }
// }
```

App.jsxì—ì„œëŠ” userSliceë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```jsx
// App.jsx
import React, { useCallback } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { login, logout } from './actions/user';

const userSlice = require('./reducers/user');

const App = () => {
 ..
  const onLogout = useCallback(() =>{
    dispatch(userSlice.actions.logout())
  }, [])
  return (
    ...
  )
};

export default App;
```



ë¹„ë™ê¸° ìš”ì²­ì„ í•´ë³´ì.

sliceì•ˆì— thunkë¥¼ ì´ìš©í•  ê²ƒì´ë‹¤.

ë¹„ë™ê¸° ì•¡ì…˜ì€ sliceì™€ í•˜ë‚˜ë¡œ ë¬¶ì¸ê²Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ê³³ì—ì„œë„ ì“¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, actionì„ ë§Œë“¤ì–´ ì£¼ì–´ì•¼í•œë‹¤.

```javascript
const {createAsyncThunk} = require('@reduxjs/toolkit');

const login = createAsyncThunk('user/login', async(data, thunkAPI)=>{
  // const state = thunk.API.getState();
  // state.user.data 
})
```

* 'user/login' : ì•¡ì…˜ì˜ ì´ë¦„

* data : ì•¡ì…˜í˜¸ì¶œë°›ëŠ” data, 

* thunkAPI



thunkì—ì„œëŠ” `pending`, `fulfilled`, `rejected`ë¡œ ìš©ì–´ë¥¼ ì‚¬ìš©í•œë‹¤. (ëŒ€ê¸°, ì„±ê³µ, ì‹¤íŒ¨)





## 03-03. createAsyncThunkë¡œ ë¹„ë™ê¸° ì²˜ë¦¬í•˜ê¸°

ì„œë²„ê°€ ë”°ë¡œì—†ê¸° ë•Œë¬¸ì— í†µì‹ ì´ ì™”ë‹¤ ì˜¨ë‹¤ ìƒê°í•˜ê³ , delayë¥¼ ì£¼ì–´ í…ŒìŠ¤íŠ¸í•´ë³¼ ê²ƒì´ë‹¤.

```javascript
const delay = (time, value) => new Promise((resolve, reject)=>{
  setTimeout(()=>{
    resolve(value);
  }, time)
})

const login = createAsyncThunk('user/login', async(data, thunkAPI)=>{
  // const state = thunk.API.getState();
  // pending, fullfilled, rejected
  console.log(data)
  const result = await delay(500, {
    userId: 1,
    nickname: 'zero'
  });
  return result ;
})
```

â— ë³´í†µ async awaitë¥¼ ì“¸ ë•Œ try catchë¡œ ê°ì‹¸ëŠ”ë°, ì—¬ê¸°ì„œëŠ” ì•ˆê°ì‹¸ëŠ”ê²Œ ì¢‹ë‹¤. => ê°ì‹¸ë²„ë¦¬ë©´ errorê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

dispatchë¡œ ë³´ë‚´ëŠ” ê°ì²´ê°€ dataê°€ ëœë‹¤.



reducer ìˆ˜ì •

```javascript
const {createSlice} = require('@/reduxjs/toolkit')
const {login} = require('../actions/user');
const { LOG_IN_REQUEST, LOG_IN_SUCCESS, LOG_IN_FAILURE, LOG_OUT } = require("../constant");
...
const userSlice = createSlice({
  name: 'user',
  initialState, 
  reducers: {
    logout(state, action){
      state.data = null;
    }
  }, // ë™ê¸°ì 
  extraReducers:{
    [login.pending](state,action){
      state.isLoggingIn = true;
    },
    [login.fulfilled](state, action){
    state.data = action.payload
      state.isLoggingIn = false;
    },
    [login.rejected](state, action){
    state.data = action.payload
      state.isLoggingIn = false;
    }
  }, // ë¹„ë™ê¸°ì 
})

module.exports=userSlice;
```

â— actionì˜ ë°ì´í„°ëŠ” action.dataê°€ ì•„ë‹ˆë¼ `payload`ì´ë‹¤.

> ì •ë¦¬
>
> Toolkitì€ reduxì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë“¤ì„ ëª¨ì•„ë†“ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬.
>
> ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë¯¸ë¦¬ ë§Œë“¤ê¸° ë•Œë¬¸ì— ëª…ì¹­ì´ ë¯¸ë¦¬ **ì •í•´ì ¸ ìˆë‹¤**.
>
> ëŒ€ê¸° -> pending
>
> ì„±ê³µ -> fulfilled
>
> ì‹¤íŒ¨ -> rejected
>
> actionì˜ data => payload

actionì˜ ì´ë¦„ì„ ë„£ëŠ” ì´ìœ 

extraReducerì—ì„œ ë³€ìˆ˜ëª…ì´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ êµ¬ë¶„. => user/logIn/fulfilled



postì˜ addPostë„ ë¹„ë™ê¸°ë¡œ í•´ë³´ì.

```javascript
// actions/post.js
const {createAsyncThunk} =require('@reduxjs/toolkit');

const delay = (time, value) => new Promise((resolve, reject)=>{
  setTimeout(()=>{
    resolve(value);
  }, time)
})
const addPost = createAsyncThunk('post/add', async()=>{
  return await delay(500, {
    title: 'ìƒˆ ê²Œì‹œê¸€',
  })
})

module.exports = {addPost}
```

```javascript
// reducer/post.js
const {createSlice} = require('@/reduxjs/toolkit')
const { addPost } = require('../actions/post');

const postSlice = createSlice({
  name: 'post',
  initialState, 
  reducers: {
    clearPost(state, action){
      state.data = [];
    }
  }, // ë™ê¸°ì 
  extraReducers:{
    [addPost.pending](state, action){},
    [addPost.fulfilled](state, action){},
    [addPost.rejected](state, action){},
  }, // ë¹„ë™ê¸°ì 
})

module.exports = postSlice;
```





## 03-04. ì•¡ì…˜ êµ¬ì¡° ì‚´í´ë³´ê¸°

```javascript
...
import { login } from './actions/user';
const userSlice = require('./reducers/user');

const App = () => {
  const user = useSelector((state)=>state.user)
  const dispatch = useDispatch();
  const onClick = useCallback(() =>{
    dispatch(login({
      id: 'jhjoe',
      password: 'ë¹„ë°€ë²ˆí˜¸'
    }))
  }, [])
  const onLogout = useCallback(() =>{
    dispatch(userSlice.actions.logout())
  }, [])
  return (
    <div>
      {user.isLoggingIn 
        ? 'ë¡œê·¸ì¸ ì¤‘'
        : user.data 
        ? user.data.nickname
        : 'ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.'}
      {!user.data 
        ? <button onClick={onClick}>ë¡œê·¸ì¸</button> 
        : <button onClick={onLogout}>ë¡œê·¸ì•„ì›ƒ</button>}
    </div>
  )
};

export default App;
```

ë™ê¸°ì¸ ê²ƒë“¤ì€ userSliceì—ì„œ ë¶ˆëŸ¬ì˜¤ê³ , ë¹„ë™ê¸°ì¸ê±´ actionì—ì„œ ë°”ë¡œ ê°€ì ¸ë‹¤ ì“´ë‹¤.

ì‹¤í–‰ì‹œì¼œ devtoolsë¥¼ ì—´ì–´ë³´ì.

ì•„ë˜ ì²˜ëŸ¼ ë¯¸ë¦¬ stateê°€ ì˜ ë§Œë“¤ì–´ì§„ ê²ƒë„ í™•ì¸ ê°€ëŠ¥.

```text
user
  isLoggingIn(pin):false
  data(pin):null
posts(pin): []
```

![toolkit_slice_actionìë™ìƒì„±_ê²°ê³¼](./readme_images/03.toolkit_slice_actionìë™ìƒì„±_ê²°ê³¼.png)

ìš”ì²­ë§ˆë‹¤ requestIdê°€ ëœë¤í•˜ê²Œ ë§Œë“¤ì–´ì§„ë‹¤. 

**ë‚´ìš© ìœ„ì¹˜**

* rejected : errorì•ˆ
* fulfilled : payload
* metaëŠ” ì²˜ìŒì— ë„£ì–´ì¤€ ë°ì´í„° ë¼ê³  ì•Œë©´ ëœë‹¤.



addPostë¥¼ ìœ„í•œ ë²„íŠ¼ ì¶”ê°€

```javascript
import React, { useCallback } from 'react';
import { useDispatch, useSelector } from 'react-redux';

import { login } from './actions/user';
import { addPost } from './actions/post';
const userSlice = require('./reducers/user');

const App = () => {
...
  const onAddPost = useCallback(()=>{
    dispatch(addPost());
  },[])

  return (
    <div>
     ...
     <button onClick={onAddPost}>ê²Œì‹œê¸€ ì‘ì„±</button>
    </div>
  )
};

export default App;
```

3ë²ˆ ì—°ì†ìœ¼ë¡œ ê²Œì‹œê¸€ ì‘ì„±ì„ ëˆ„ë¥´ë©´ ì–´ë–¤ pendingì´ ì–´ë–¤ fulfilledì¸ì§€ requestIdë¥¼ í†µí•´ ì•Œ ìˆ˜ ìˆë‹¤.



postSliceë¥¼ ë§ˆì € ì™„ì„±í•´ë³´ì

```javascript
...
const postSlice = createSlice({
  name: 'post',
  initialState,
  reducers: {
    clearPost(state, action){
      state.data = [];
    }
  }, // ë™ê¸°ì 
  extraReducers:{
    [addPost.pending](state, action){

    },
    [addPost.fulfilled](state, action){
      state.data.push(action.payload)
    },
    [addPost.rejected](state, action){

    },
  }, // ë¹„ë™ê¸°ì 
})

module.exports = postSlice;
```

immerì“¸ë•Œ state ìì²´ë¥¼ í†µì§¸ë¡œ ë°”ê¾¸ëŠ” ê²½ìš°ê°€ ê°„í˜¹ ìƒê²¨ì„œ ë¶ˆë³€ì„±ì´ ê¹¨ì§ˆ ë•Œê°€ ìˆë‹¤.

ê·¸ëŸ°ê²½ìš° ê°’ì„ ë”°ë¡œ ë‹´ì•„ returní•´ì£¼ëŠ” í˜•íƒœë¥¼ ì‚¬ìš©.

```javascript
[addPost.pending](state, action){
	state = '123';
    return state;
},
```



### builder

extraReducersë¥¼ ë‹¤ë¥´ê²Œ ì‘ì„±í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•ì´ ìˆë‹¤.

builderì— ì²´ì¸ í˜•ì‹ìœ¼ë¡œ addCaseë¥¼ ì“°ëŠ” ë°©ë²•.

```javascript
  extraReducers: (builder) =>
    builder
      .addCase(addPost.pending, (state, action) => {})
      .addCase(addPost.fulfilled, (state, action) => {
        state.data.push(action.payload);
      })
      .addCase(addPost.rejected, (state, action) => {}),
```

â— typescriptë¥¼ ì“¸ ë•Œ íƒ€ì…ì¶”ë¡ ì´ ì´ ë°©ì‹ì´ ë” ì˜ëœë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ `addDefaultCase`ë¡œ switchë¬¸ì˜ defaultì²˜ëŸ¼ ë„£ì–´ì¤„ ìˆ˜ë„ ìˆê³ , `addMatcher`ë¡œ ì¡°ê±´ì„ ì¤„ ìˆ˜ ìˆë‹¤.

3ê°œê°€ ì„¸íŠ¸ë¡œ ìŒ“ì´ë©´ì„œ, ê³µí†µì ì¸ ë¶€ë¶„ì´ ìƒê¸¸ ê²ƒì´ë‹¤. ê·¸ë•Œ addMatcherë¥¼ ì‚¬ìš©.

```javascript
addMatcher((action)=>{
    return action.type.includes('/pending')
}, (state, action)=>{
    state.isLoading = true;
})
```

(switchë¬¸ì—ì„œëŠ” caseë¥¼ ì—¬ëŸ¬ê°œ ì´ì–´ì„œ ì‚¬ìš©í–ˆë‹¤.)





## 03-05. ë¦¬ë•ìŠ¤ë¥¼ ì“°ì§€ ë§ì•„ì•¼ í•  ë•Œ (ì¸í’‹)

ë¦¬ë•ìŠ¤ ì“¸ë•Œì™€ ì•ˆì“¸ë•Œë¥¼ ëª…í™•íˆ êµ¬ë¶„í•´ì•¼í•œë‹¤.

ìš°ì„  Inputì—ì„œ ì™ ë§Œí•˜ë©´ ì•ˆì“°ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```jsx
<form action = "">
	<input type="email" value={} onChange={onChangeEmial}/>
    <input teype="password" value={} onChange={onChangePassword}/>
</form>
```

ë™ì‘ì€ í•˜ì§€ë§Œ, 1ê¸€ì ì¹ ë•Œë§ˆë‹¤ actionì´ ë‚˜ì˜¤ê²Œ ëœë‹¤.

ë§Œì•½ í•„ìš”í•˜ë‹¤ë©´, onBlurë¥¼ ì´ìš©í•˜ê±°ë‚˜ submití• ë•Œ ë“± í•œ ë²ˆë§Œ, dispatchí•˜ëŠ”ê²Œ ì¢‹ë‹¤.

â—  eslintì—ì„œ useCallbackì— dispatchë¥¼ ì•ˆë„£ëŠ”ë‹¤ëŠ” ê²½ê³ ê°€ ëœ¨ë©´, dispatchë„£ì–´ë„ ìƒê´€ì—†ë‹¤.



ë˜ 1ê¸€ì ì¹ ë•Œë§ˆë‹¤ actionì„ ì¹˜ê²Œë˜ë©´, ë¬¸ì œê°€ ë˜ ìˆë‹¤.

```jsx
const App = () => {
  const {email, password} = useSelector((state)=>state.user)
  const dispatch = useDispatch();
    ...
```

ì—¬ê¸°ì„œ ì € userê°€ 1ê¸€ì ì¹ ë•Œë§ˆë‹¤ ë¦¬ëœë”ë§ ë˜ê²Œëœë‹¤.



useStateë„ ë˜‘ê°™ì§€ì•Šë‚˜?

ì¼ë‹¨ ë˜‘ê°™ë‹¤. ê·¼ë° ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ userë¥¼ ì“°ê³ ìˆë‹¤ê³  í•˜ë©´, Appì—ì„œ userê°€ ë°”ë€Œì–´ ë¦¬ëœë”ë§ì´ë˜ë©´, ê·¸ userë¥¼ ì“°ê³ ìˆëŠ” ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ë“¤ë„ ê°™ì´ ë¦¬ëœë”ë§ ëœë‹¤.

ê·¸ë˜ì„œ ê°ì²´ë¡œ ì“°ëŠ”ê²Œ ì¢‹ì€ ìŠµê´€ì´ ì•„ë‹ˆë‹¤.

ê·¸ë˜ì„œ í•˜ë‚˜í•˜ë‚˜ ìª¼ê°œëŠ”ê²Œ ì¢‹ë‹¤. => ë¦¬í„´í•˜ëŠ”ê²Œ ê°ì²´ê°€ì•„ë‹Œ ê°’ì¸ê²Œ ì¢‹ë‹¤.

```javascript
const email = useSelector((state)=>state.user.email);
const password = useSelector((state)=>state.user.password);
```

í•˜ì§€ë§Œ, ë„ˆë¬´ ë§ìœ¼ë©´ ë˜ ì¢‹ì§€ ì•Šìœ¼ë‹ˆ ì„±ëŠ¥ìƒ ë¬¸ì œê°€ í¬ê²Œ ì—†ë‹¤ë©´ ê°ì²´ë¡œ ì‚¬ìš©.

ê²°ë¡ ) í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ì“°ì´ëŠ” ê²ƒë“¤ì€ reducerë¡œ ê´€ë¦¬í•˜ì§€ë§ê³ , stateë¡œ ê´€ë¦¬ í›„ ìµœì¢…ì ì¸ê±°ë§Œ reducerë¡œ ì‚¬ìš©



## 03-06. ë¦¬ë•ìŠ¤ë¥¼ ì“°ì§€ ë§ì•„ì•¼  í•  ë•Œ (ë¹„ë™ê¸°)

ë¹„ë™ê¸° ì„œë²„ìš”ì²­ì´ **í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ì“°ë©´**, ë¹„ë™ê¸° ì•¡ì…˜ìœ¼ë¡œ ë§Œë“¤ì§€ ë§ê³ , useCallback ì•ˆì—ì„œ ì²˜ë¦¬

ëŒ€ì‹  ë¦¬ë•ìŠ¤ë‘ ë¹„ìŠ·í•˜ê²ŒëŠ” ì²˜ë¦¬.

```jsx
const [isLoading, setLogding] = useState(false)
const [error, setError] = useState(false)
const [done, setDone] = useState(false)

const oncClick =useCallback(async()=>{
    setLoading(true);
    setDone(false);
    setError(false);
    try{
        const ers = await axios.post('/login');
        setDone(true);
    }catch{
        setError(false);
    }finally{
        setLoading(false)
    }
},[])
```



ë¹„ë™ê¸° ìš”ì²­ë“¤ì´ ê³„ì† ìƒê¸°ë‹¤ ë³´ë©´, `isLoading`, `error`, `done` ì´ê²Œ ê³„ì† ìƒê¸¸ ê²ƒì´ë‹¤.

ë³´ê¸°ë„ ì§€ì €ë¶„í•˜ê³ , ì´ë¦„ì§“ê¸°ë„í˜ë“¬.

ê·¸ë¦¬ê³  ë¬¸ì œê°€ í•˜ë‚˜ì˜ ë²„íŠ¼ì´ ì—¬ëŸ¬ë²ˆ ìš”ì²­(ê°™ì€ìš”ì²­ì„)í–ˆì„ ë•Œ, (1ë²ˆ ìš”ì²­ì€ ì„±ê³µ, 2ë²ˆ ìš”ì²­ì€ ì‹¤íŒ¨, 3ë²ˆìš”ì²­ì€ ì„±ê³µ).

ê·¸ê±°ë¥¼ í•˜ë‚˜ì˜ stateë¡œ í‘œí˜„í•˜ê¸°ê°€ ì–´ë µë‹¤.

ì–´ë–»ê²Œ í•´ê²°?

ë³€ìˆ˜ë¥¼ ê³„ì† ìƒì„±í•˜ê¸° ë³´ë‹¤ëŠ”(ì•„ë˜ë¡œ ì¦ê°€) **ë°°ì—´ì´ë‚˜ ê°ì²´ë¡œ** ë‹´ì•„ (ê°€ë¡œë¡œ ì¦ê°€) ê´€ë¦¬.

ì´ë•Œ keyëŠ” ì¤‘ë³µì•ˆë˜ê²Œ.

```jsx
const [loadings, setLogdings] = useState({})
const [errors, setErrors] = useState({})
const [dones, setDones] = useState({})
const [loadingIds, setLoadingIds] = useState([]);

const oncClick =useCallback(async()=>{
const id = new Date().valueOf();
    setLoadings((prev)=>{
        ...prev,
        [id]: {type: 'LOGIN_LOADING'}
    });    
    setLoadingIds((prev)=>prev.concat(id))
    try{
        const res = await axios.post('/login');
        setDones((prev)=>{
        ...prev,
        [id]: {type: 'LOGIN_DONE'}
    });
    }catch{
        setError(false);
    }finally{
        setLoadings((prev)=>{
            const newObj = JSON.parse(JSON.stringify(prev)); // ê¹Šì€ ë³µì‚¬
            delete newObj[id];
            return newObj
        });   
    }
},[])
```





## 03-07. createSelector(reselect)

useSelectorì— êµ¬ì¡°ë¶„í•´í• ë‹¹ì„ í•˜ê²Œë˜ë©´, ì“¸ë°ì—†ëŠ” ë¦¬ëœë”ë§ì´ ë§ì´ ì¼ì–´ë‚œë‹¤ê³  í–ˆì—ˆë‹¤.

í•´ê²°ì±…ìœ¼ë¡œ ì›ì‹œê°’ìœ¼ë¡œ useSelectorë¥¼ ë§Œë“¤ê³ , ë„ˆë¬´ ë§ì„ë•Œ ì„±ëŠ¥ìƒì— ë¬¸ì œê°€ ì—†ìœ¼ë©´ êµ¬ì¡°ë¶„í•´í• ë‹¹ì„ í•œë‹¤ í–ˆì—ˆë‹¤.

í•˜ì§€ë§Œ ì§„ì§œ ë¬¸ì œê°€ ìƒê¸°ë©´? => useSelectorë¥¼ í•˜ë‚˜í•˜ë‚˜ ìƒì„±í•´ë„ ë˜ì§€ë§Œ, `createSelector`ë¼ê³  toolkitì´ ì œê³µí•˜ëŠ” ê±¸ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

`createSelector`ëŠ” reselectë¥¼ toolkitì•ˆì— ë„£ì€ ê²ƒì´ë‹¤.

```jsx
import {createSelector} from '@reduxjs/toolkit'; // reselect
```



**Example**

```javascript
const initialState = {
	    email: ...,
	    prices: Array(100).fill().map((_,i)=> (i+1)*100),
        ...
}
```

ì´ê±¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë”í•œë‹¤ê³  ìƒê°í•´ë³´ì.

```jsx
const App = () =>{
    const pricies = useSelector((state)=>state.users.prices);

    return(
        <>
            <div>ì´í•© : {prices.reduce((a,c)=>a+c, 0}</div>
        </>
    )
}
```

ë™ì‘ì€ ì˜ ë˜ì§€ë§Œ, ë¬¸ì œê°€ ìˆë‹¤.

ë§Œì•½ emailì´ í•œê¸€ì ì¹ ë•Œë§ˆë‹¤ ë¦¬ëœë”ë§ ë˜ë©´? => ê³„ì‚°ë„ ë‹¤ì‹œí•œë‹¤.



ì—°ì‚°ì´ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ìºì‹±í•´ì£¼ì–´ì•¼í•œë‹¤.

1.useMemoì‚¬ìš©.

```jsx
const totalPrice = useMemo(()=>prices.reduce((a,c)=>a+c, 0), [prices])
...
return (
  <>
    <div>ì´í•© : {prices.reduce((a,c)=>a+c, 0}</div>
  </>
)
```

ë¦¬ëœë”ë§ë˜ë„ ì—°ì‚°ì€ í•œ ë²ˆ.

í•©ì„ êµ¬í•˜ëŠ” ì—°ì‚°ì€ ì•ˆí•˜ì§€ë§Œ, pricesì˜ ê°’ì´ ë°”ë€Œì—ˆë‚˜ ì•ˆë°”ë€Œì—ˆë‚˜ëŠ” í•¨. <br/>=> ì¢€ ë” ì‘ì€ ë¹„ìš©ì˜ ì—°ì‚°ì„ í•˜ë„ë¡ ì„ íƒ. ê°’ì„ ë¹„êµí•˜ê±°ë‚˜ ê³„ì‚°í•˜ê±°ë‚˜.

ì´ í•´ê²°ì±…ì´ ë°”ë¡œ createSelector

ì»´í¬ë„ŒíŠ¸ ìœ—ë‹¨ì—ì„œ ìµœì í™” í•˜ëŠ” ë°©ë²•

```jsx
const priceSelector = (state) => state.user.prices;
const sumPriceSelector = createSelector(
	priceSelector,
    (prices)=>prices.reduce((a,c)=>a+c,0)
);

const App = () =>{
    const totalPrice = useSelector(sumPriceSelector);
    ...
    return(
      <>
        <div>ì´í•© : {totalPrice}</div>
      </>
    )
}
```

í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í•¨ìˆ˜ ë°–ì— ê±¸ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ”ê±´(ìˆœìˆ˜í•¨ìˆ˜ëŠ”) ë°–ìœ¼ë¡œ ëº„ ìˆ˜ ìˆë‹¤.

ë‚´ë¶€ ê±¸ ì°¸ì¡°í•˜ëŠ” ê²ƒë“¤ì€ ê³ ì°¨í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ ë¹¼ëŠ” ë°©ë²•ë„ ìˆê¸´í•˜ë‹¤.

```jsx
const outside = (dispatch) = () =>{
    dispatch(login({
        ...
    }))
}
```



â— createSelectorëŠ” ì¬ì‚¬ìš©í•˜ë©´ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆë‹¤.

```jsx
// ì´ë ‡ê²Œ X.
export const sumPriceSelector = createSelector(
	priceSelector,
    (prices)=>prices.reduce((a,c)=>a+c,0)
);
```

í•¨ìˆ˜ë¡œ í•œë²ˆ ë” ê°ì‹¸ì„œ exportí•´ì•¼í•œë‹¤. (ê³µì‹ë¬¸ì„œ ì°¸ê³ .)

```jsx
const makeSumPriceSelector = () => createSelector(
	priceSelector,
    (prices)=>prices.reduce((a,c)=>a+c,0)
);
```

[ğŸ“˜ reselect Github](https://github.com/reduxjs/reselect)