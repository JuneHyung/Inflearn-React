# 05. mobx-react

## 05-01. mobx-react ì‚¬ìš©í•˜ê¸°

`mobx-react`ë¥¼ `class component`ì™€ `hooks`ì—ì„œ ì‚¬ìš©í•´ë³´ì.

reactì— ë¶™ì´ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ë‹ˆ ë‚˜ì¤‘ì— ë‹¤ë¥¸ ì½”ë“œë¥¼ ë´¤ì„ ë•Œ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. ìœ ì˜!

**package.json**

class componentì—ì„œ ì¶”ê°€ëœê²Œ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´`@babel/plugin-proposal-decorators`ë¥¼ ì¶”ê°€.

ê·¸ë¦¬ê³  ì‚¬ìš©í•´ë³¼ `mobx-react`ë¥¼ ì¶”ê°€

```json
{
  "name": "08.mobx-react",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "webpack serve --env development"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@babel/plugin-proposal-class-properties": "^7.12.1",
    "mobx": "^6.0.4",
    "mobx-react": "^7.0.5",
    "react": "^17.0.1",
    "react-dom": "^17.0.1"
  },
  "devDependencies": {
    "@babel/core": "^7.12.9",
    "@babel/preset-env": "^7.12.7",
    "@babel/preset-react": "^7.12.7",
    "@pmmmwh/react-refresh-webpack-plugin": "^0.5.4",
    "babel-loader": "^8.2.2",
    "react-refresh": "^0.11.0",
    "webpack": "^5.9.0",
    "webpack-cli": "^4.2.0",
    "webpack-dev-server": "^4.7.1"
  }
}
```

**mobx-react**

mobxì™€ reactë¥¼ ì—°ê²° í•´ì£¼ëŠ” ì—­í• ì¸ë° ì•ˆì— ì˜µì €ë²„ë¥¼ í¬í•¨í•˜ê³ ìˆì–´ì„œ, observableì´ ì¼ì–´ë‚ ë•Œ ë§ˆë‹¤ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ëœë”ë§ í•´ì¤€ë‹¤.



webpack.config.jsì— ì¶”ê°€ ëœê²Œ ìˆë‹¤.

decoratorë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì€ í˜•íƒœë¡œ ì˜µì…˜ì„ ì£¼ì–´ pluginsì— ì¶”ê°€í•´ì£¼ì–´ì•¼í•œë‹¤.

```js
...
plugis: [
  "react-hot-loader/babel",
  ["@babel/plugin-proposal-decorators", {legacy: true}],
  ["@babel/plugin-porposal-class-properties", {loose: true}],
],
...
```



mobxë¥¼ ì“°ë©´ reactì˜ stateë¥¼ ì•„ì˜ˆ ì—†ì—˜ ìˆ˜ ìˆë‹¤.

mobxëŠ” stateë§ˆì € observableë¡œ ë§Œë“¤ì–´ ì•ˆì“¸ ìˆ˜ ìˆë‹¤.

```jsx
// client.jsx
import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';

ReactDOM.render(
  <App />,
  document.querySelector('#root'),
);
```

`redux`ì™€ ë‹¤ë¥´ê²Œ `mobx`ëŠ” `Provider`ë¡œ ê°ì‹¸ì§€ ì•ŠëŠ”ë‹¤. (ê°ì‹¸ëŠ” ê²½ìš°ë„ ìˆë‹¤.)



**App.jsx ì‘ì„±**

```jsx
// App.jsx
import React, { Component } from 'react';
import { observable } from 'mobx';
import { observer } from 'mobx-react';

import { } from './store';

@observer
class App extends Component {
  onLogin = ()=>{}
  onLogout = () =>{}

  render() {
    
  }
}

export default App;
```

`observer`ë¥¼` mobx-react`ë¡œ ë¶€í„° ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

observerëŠ” classì»´í¬ë„ŒíŠ¸ ìœ„ì— `@observer`í˜•íƒœë¡œ ë¶™ì—¬ì¤€ë‹¤.



mobxëŠ” stateë¥¼ observableë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê±¸ ë³´ê¸° ìœ„í•´ inputì¶”ê°€.

```jsx
...
@observer
class App extends Component {
	...
  onChangeName = (e) => {
    this.state.name = e.target.value;
  }
  onChangePassword = (e) =>{
    this.state.password = e.target.value;
  }
  render() {
    return (
      <div>
        {userStore.isLoggingIn
          ? <div>ë¡œê·¸ì¸ ì¤‘</div>
          : userStore.data
            ? <div>{userStore.data.nickname}</div>
            : 'ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.'}
        {!userStore.data
          ? <button onClick={this.onClick}>ë¡œê·¸ì¸</button>
          : <button onClick={this.onLogout}>ë¡œê·¸ì•„ì›ƒ</button>}
        <div>{postStore.data.length}</div>
        <input value={this.state.name} onChange={this.onChangeName} />
        <input value={this.state.password} type="password" onChange={this.onChangePassword}  />
      </div>
    );
  }
}

export default App;
```



â— ë‹¤ì‹œí•œë²ˆ! mobxì—ì„œëŠ” storeê°€ í•˜ë‚˜ë¡œ ë¬¶ì¼ í•„ìš”ê°€ ì—†ë‹¤.

```javascript
// store.js
const { observable } = require('mobx');

const userStore = observable({
  isLoggingIn: false,
  data: null,
  logIn(data) {
    this.isLoggingIn = true;
    setTimeout(() => {
      this.data = data;
      this.isLoggingIn = false;
      postStore.data.push(1);
    }, 2000);
  },
  logOut() {
    this.data = null;
  },
});

const postStore = observable({
  data: [],
  addPost(data) {
    this.data.push(data);
  },
});

export { userStore, postStore };
```

mobxì—ì„œ ovservableì„ ê°€ì ¸ì™€ ê°ì²´ë¥¼ ê°ì‹¸ì£¼ì—ˆë‹¤.

`ë©”ì„œë“œë¶€ë¶„`ì„ **actionì´ ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„**ì´ë¼ ìƒê°í•˜ë©´ ëœë‹¤.

ê°€ë” ê°ì‹¸ì§€ ì•Šê³ , classì²˜ëŸ¼ ìœ„ì— `@obervable`ì„ ë¶™ì´ëŠ” ê²½ìš°ë„ ìˆë‹¤.

ê·¸ì „ì— ì ê¹ ë°ì½”ë ˆì´í„°ì— ëŒ€í•´ ì•Œì•„ë³´ì.

> â— ë°ì½”ë ˆì´í„°
>
> ë°ì½”ë ˆì´í„°ëŠ” ìš°ì„  í•¨ìˆ˜ì´ë‹¤.
>
> ```jsx
> @observer
> class App extends Component {...}
> ```
>
> ì—¬ê¸°ì„œ @ë¥¼ ë–¼ë©´
>
> ```jsx
> observer(class App extends ...)
> ```
>
> ìœ„ ì²˜ëŸ¼ ë°ì½”ë ˆì´í„°ê°€ ê°ì‹¸ì£¼ëŠ” ì—­í• ì´ë‹¤.
>
> observerë¿ë§Œ ì•„ë‹ˆë¼ ë˜ ë‹¤ë¥¸ ë°ì½”ë ˆì´í„°ë¡œ ê°ì‹¸ëŠ” ê²½ìš°ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.
>
> í•˜ì´ì˜¤ë” ì»´í¬ë„ŒíŠ¸ / í•˜ì´ì˜¤ë” functionê°™ì€ ê²ƒë“¤ì„ ë°–ìœ¼ë¡œ ë¹¼ì„œ ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì—­í• .
>
> classë“¤ê³¼ exportë“¤ì„ ë°ì½”ë ˆì´í„°ë¡œ ê°ìŒ€ ìˆ˜ ìˆëŠ”ë°, ë°ì½”ë ˆì´í„°ê°€ ì‹¤í—˜ì ì¸ ë¬¸ë²•ì´ë¼ ì„¤ì •ì´ ì•ˆë˜ëŠ” ê²½ìš°ë„ ìˆë‹¤.
>
> ìš°ì„  ì¼ë°˜ ê°ì²´ ë¦¬í„°ëŸ´ í˜•íƒœë¼ë©´ @observableì´ ì•ˆëœë‹¤.
>
> ê·¸ë˜ì„œ í•¨ìˆ˜í˜•íƒœë¡œ ê°ì‹¸ì£¼ì–´ì•¼í•œë‹¤.
>
> ```jsx
> const userStore = observable({
>   isLoggingIn: false,
>   data: null,
>   logIn(data) {
>     this.isLoggingIn = true;
>     setTimeout(() => {
>       this.data = data;
>       this.isLoggingIn = false;
>       postStore.data.push(1);
>     }, 2000);
>   },
>   logOut() {
>     this.data = null;
>   },
> });
> ```

mobxê°€ reduxë³´ë‹¤ í¸í•œì .

logInì—ì„œ postStoreì„ ë³€ê²½í•˜ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

ì´ì²˜ëŸ¼ mobxëŠ” userStoreì˜ ì•¡ì…˜ì€ userStoreì— ë‹¬ë¦° Actionë§Œ ê±´ë“œë¦´ ìˆ˜ ìˆì—ˆëŠ”ë° ë‹¤ë¥¸ Storeì˜ ì•¡ì…˜ë„ ê±´ë“œë¦´ ìˆ˜ ìˆë‹¤.



## 05-02. observeì™€ mobx-devtools

App.jsxì—ì„œ storeë¥¼ ë¶ˆëŸ¬ì™€ ì—°ê²°í•´ë³´ì.

ê·¸ëƒ¥ storeì˜ ë©”ì„œë“œë¥¼ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•˜ë©´ëœë‹¤.

```jsx
// App.jsx
...
import {userStore, postStore } from './store';

@observer
class App extends Component {
  onLogin = ()=>{
    userStore.logIn({
      nickname: 'zero',
      password: 'ë¹„ë°€ë²ˆí˜¸'
    });
  }
  onLogout = () =>{
    userStore.logOut();
  }
 ...
}

export default App;
```

ë°ì´í„°ë¥¼ ë°”ê¾¸ë©´ observer ì—°ê²°ì„ í•´ì¤¬ê¸° ë•Œë¬¸ì— observerê°€ ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ ë°ì´í„°ê°€ ë°”ë€Œë©´, ìë™ìœ¼ë¡œ ë¦¬ëœë”ë§ í•´ì¤€ë‹¤.



ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œë§Œ stateë¥¼ ì“°ê³ ì‹¶ì„ ë•Œ.

```jsx
import React, { Component } from 'react';
import { observable } from 'mobx';
import { observer } from 'mobx-react';

import {userStore, postStore } from './store';

@observer
class App extends Component {

  state = observable({
    name: '',
    password:'',
  })

  ...
  onChangeName = (e) => {
    this.state.name = e.target.value;
  }
  onChangePassword = (e) =>{
    this.state.password = e.target.value;
  }
  render() {
    ...
  }
}

export default App;
```

stateë¥¼ obervableë¡œ ê°ì‹¸ì£¼ê³ , ì‚¬ìš©í•  í•¨ìˆ˜ì—ì„œëŠ” setStateê°€ ì•„ë‹ˆë¼ this.state.name = ë³€ê²½ê°’

í˜•ì‹ìœ¼ë¡œ ë°”ë¡œ ë°”ê¿”ë„ ëœë‹¤.

reduxì—ì„œëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ `redux-thunk`ë‚˜ `redux-saga`ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í–ˆì—ˆëŠ”ë°

mobxì—ì„œëŠ” ë¹„ë™ê¸°ì²˜ë¦¬ë¥¼ ê·¸ëƒ¥ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```jsx
const { observable } = require('mobx');

const userStore = observable({
	...
  logIn(data) {
    this.isLoggingIn = true;
		axios().get().then(()=>{this.state = data});
    setTimeout(() => {
      this.data = data;
      this.isLoggingIn = false;
      postStore.data.push(1); // reduxì— ë¹„í•´ í¸í•œ ì 
    }, 2000);
  },
  ...
});
...
```



mobxë„ devtoolì´ ìˆë‹¤.

`MobX Developer Tools`  : ë°”ë€ŒëŠ”ê²Œ ì¶”ì ê°€ëŠ¥ í•˜ë‹¤.

>  MST (MobX State Tree)
>
> MobXê°€ ë„ˆë¬´ ììœ ë¡œìš¸ ë•Œ, ì˜ ë™ì‘í•˜ëŠ”ë° ì´ëŒ€ë¡œ í•´ë„ë˜ëŠ”ì§€ ì• ë§¤í• ë•Œ ì‚¬ìš©í•˜ë©´ í‹€ì´ ì–´ëŠì •ë„ ì¡íŒë‹¤.

ì˜›ì½”ë“œì¤‘ì—ì„œëŠ” mobxì—ì„œë„ providerë¥¼ ê°ì‹¼ ì½”ë“œë¥¼ ë³¼ ìˆ˜ë„ ìˆë‹¤.

ê·¸ëŸ° ê²½ìš° injext()ë‘ ìŒì„ ì´ë¤„ìˆì„ ê²ƒì´ë‹¤.

```jsx
<Provider>
	<Hot />
</Provider>
```

```jsx
import {inject, Provider} from 'mobx-react'
...
export default inject()(App)
ë˜ëŠ”
...
@inject('userStore')
export default App
```

ìœ„ì™€ ê°™ì€ ê²½ìš°ë¼ í•˜ë©´ userStoreê°€ `this.props.userStore`ì²˜ëŸ¼ propsì— ë“¤ì–´ê°€ ìˆë‹¤.

contextAPIê°€ ë‚˜ì˜¤ê³ ì„œ mobxì—ì„œ Providerì™€ injectë¥¼ ì“°ì§€ë§ë¼ê³  í•œë‹¤.

contextAPIë¥¼ ì‚¬ìš©í•œê²½ìš° Providerë¡œ ê°ì‹¸ì ¸ìˆë‹¤ë©´, returnë¶€ë¶„ì— Consumerë¡œ ê°ì‹¸ì ¸ ìˆëŠ” í˜•íƒœì˜ ì½”ë“œë„ ìˆë‹¤.

```jsx
render(){
  return (
    <Consumer>
      ({useStore, postStore})=>()
    </Consumer>
  )  
}
```





## 05-03. mobx-reactì™€ hooks

ì´ë²ˆì—” Hooks ì»´í¬ë„ŒíŠ¸ë¡œ ì•Œì•„ë³´ì. ë¨¼ì €, Class -> Hooksë¡œ ë³€ê²½

HooksëŠ” í•¨ìˆ˜ê¸° ë•Œë¬¸ì— `@observer`ë¡œ ì“°ì§€ ëª»í•œë‹¤.

`useObserver`ë¥¼ ì œê³µí•¨.

```jsx
// App.jsx
...
const App => () =>{
  return useObserver(()=>(
    <div></div>
  ))
}
```

localStateì˜ ê²½ìš° observableë¡œ ê°ì‹¸ì„œ ì‚¬ìš©í•´ë„ ë™ì‘ì€í•œë‹¤.

```jsx
const state = observable({ ... })
```

ê·¼ë° mobx-reactì—ì„œ `useLocalStore`ë¥¼ ì œê³µí•œë‹¤.

```jsx
import React, { useCallback } from "react";
import { observer, useLocalStore, useObserver } from "mobx-react";
import { observable } from "mobx";

import { userStore, postStore } from "./store";

const App = () => {
  // const state = obervable({})
  const state = useLocalStore(()=>({
    name: '',
    password: '',
    onChangeName(e){
      this.state.name = e.target.value;
    },
    onChangePassword(e){
      this.state.password = e.target.value;
    }
  }))

  return useObserver(() => {
    const onClick = useCallback(() => {
      userStore.logIn({
        nickname: "zerocho",
        password: "ë¹„ë°€ë²ˆí˜¸",
      });
    }, []);

    const onLogout = useCallback(() => {
      userStore.logOut();
    }, []);
    <div>
      {userStore.isLoggingIn ? (
        <div>ë¡œê·¸ì¸ ì¤‘</div>
      ) : userStore.data ? (
        <div>{userStore.data.nickname}</div>
      ) : (
        "ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”."
      )}
      {!userStore.data ? (
        <button onClick={onClick}>ë¡œê·¸ì¸</button>
      ) : (
        <button onClick={onLogout}>ë¡œê·¸ì•„ì›ƒ</button>
      )}
      <div>{postStore.data.length}</div>
      <input value={state.name} onChange={state.onChangeName} />
      <input
        value={state.password}
        type="password"
        onChange={state.onChangePassword}
      />
    </div>;
  });
};

export default observer(App);
```

â— í•­ìƒ Hooksì—ì„œëŠ” `useObserver`, classì—ì„  `@observer`ê°€ ìˆì–´ì•¼ë§Œ obervableì´ ë°”ë€”ë•Œ ë°˜ì‘ì„ í•œë‹¤.



ê³µì‹ë¬¸ì„œì—ì„œëŠ” contextAPIë¡œ globalStateë¥¼ ê´€ë¦¬í•˜ëŠ”ê²Œ í•˜ë‚˜ ë” ë‚˜ì˜¨ë‹¤.

### ì»´í¬ë„ŒíŠ¸ì™€ storeë¥¼ ë¬¶ëŠ” ë°©ë²•

Context.jsxë¥¼ ë§Œë“¤ì

```javascript
// Context.jsx
import * as React from 'react';
import { userStore, postStore } from './store';

export const storeContext = React.createContext({
  userStore,
  postStore,
});

export const StoreProvider = ({ children }) => {
  return (
    <storeContext.Provider>
      {children}
    </storeContext.Provider>
  );
};

export default StoreProvider;

```

`React.createContext`ì—ë‹¤ê°€ storeë“¤ì„ ë¬¶ì–´ì£¼ë©´, `storeContext`ë¡œ ë¬¶ì¸ë‹¤.

ê·¸ë‹¤ìŒ `Provider`ë¥¼ contextì—ì„œ êº¼ë‚´ì™€ì„œ ë§Œë“¤ì–´ì£¼ê³ ,

ProviderëŠ” Client.jsxì—ì„œ ì‚¬ìš©ëœë‹¤.

```jsx
// client.jsx
const Hot = hot(App);
...
return(
<storeContext.Provider>
	<Hot></Hot>      
</storeContext.Provider>
)
```

Hotì´ë‘ Appì—ì„œ userStoreì™€ postStoreë¥¼ ì“¸ ìˆ˜ ìˆê²Œ context ê´€ê³„ê°€ ëœë‹¤.

â— `useStore`ëŠ” `customHook`ìœ¼ë¡œ ì•„ê¹Œ ë§Œë“¤ì—ˆë˜ contextë¥¼ ì‚¬ìš©.

```jsx
// useStore.js
import * as React from 'react';
import { storeContext } from './Context';

function useStore() {
  const { userStore, postStore } = React.useContext(storeContext);
  return { userStore, postStore };
}

export default useStore;
```

Appì—ì„œ userStore, postStoreë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ê²Œ ì•„ë‹ˆë¼  useStoreë¥¼ ê°€ì ¸ì˜´.

```jsx
// App.jsx
import useStore from './useStore';

const App = () => {
  const {userStore, postStore} = useStoer();
  ...
}
```

useStoreë¼ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ë§Œë“¤ì–´ ë¬¶ì–´ì£¼ê¸°

(ê³µì‹ë¬¸ì„œì—ì„œ ë¬¶ì–´ì£¼ëŠ” ê±¸ ì†Œê°œí•´ì£¼ì—ˆëŠ”ë° êµ³ì´ í•  í•„ìš”ê°€ ìˆëŠ”ì§€ ìƒê°í•´ë³´ê¸°.<br/>ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ë•Œ ë¬¶ì¸ ê²ƒê³¼ ì•„ë‹Œê²ƒì´ ì°¨ì´ë‚  ë•Œê°€ ìˆë‹¤.)





## 05-04. decorator ì‚¬ìš©í•´ë³´ê¸°

classê°€ decoratorê°€ ë˜ë©´ì„œ classì˜ ì†ì„±ë“¤ì—ë„ decoratorë¥¼ ì ìš©í•˜ëŠ” í˜•íƒœë„ ëœë‹¤.

```jsx
class App extends Component{
  @observable state={
    name:'',
    password:'',
  }
  
  @action onLogIn = () =>{
    ...
  }
}
```

ì´ë ‡ê²Œ ë˜ë©´ ì•„ë§ˆ ì—ëŸ¬ê°€ ë‚ ê²ƒì´ë‹¤.

```jsx
class App extends Component{
  state=observable({
    name:'',
    password:'',
  })
}
```

â— ë‹¤ì‹œí•œë²ˆ! decoratorë¥¼ ì‚¬ìš©í•  ë• í•­ìƒ ì ìš©ë˜ëŠ”ì§€ ì°¾ì•„ë³´ê³ , ì‚¬ìš©. í•¨ë¶€ë¡œ ì“°ì§€ ë§ê¸°.<br/>ê·¸ë¦¬ê³  babel pluginì¶”ê°€ ìŠì§€ë§ê¸°.



reduxì—ì„œ ë‹¤ë¥¸ storeì˜ actionì‚¬ìš©.

```jsx
const { LOG_IN_REQUEST, LOG_IN_SUCCESS, LOG_IN_FAILURE, LOG_OUT } = require("../constant");

const login = (data) => { // async action creator
  return (dispatch, getState)=>{
    dispatch(loginRequest(data));
    try{
      setTimeout(()=>{ // ì„ì˜ë¡œ 
        dispatch(loginSuccess({
          userId: 1,
          nickname: 'zero'
        }));
      }, 2000) 
      
      // axios.post().then().catch()ìœ¼ë¡œ ë‚˜ì¤‘ì— ëŒ€ì²´
    }catch(e){
      dispatch(loginFailure(e))
    }
  }
}
```

ìœ„ ì²˜ëŸ¼ ë¹„ë™ê¸°ê°€ ì•„ë‹ˆë”ë¼ë„ `ë¹„ë™ê¸° ì•¡ì…˜ í¬ë¦¬ì—ì´í„°`ë¥¼ ë§Œë“¤ì–´ ì£¼ì–´ì•¼ í•œë‹¤.

```javascript
...
const login = (data) => { // async action creator
  return (dispatch, getState)=>{
    dispatch(loginRequest(data));
    try{
      setTimeout(()=>{ // ì„ì˜ë¡œ 
        dispatch(loginSuccess({
          userId: 1,
          nickname: 'zero'
        }));
        dispatch(addPost())
      }, 2000) 
      
      // axios.post().then().catch()ìœ¼ë¡œ ë‚˜ì¤‘ì— ëŒ€ì²´
    }catch(e){
      dispatch(loginFailure(e))
    }
  }
}
```

ì´ë ‡ê²Œ ë˜ë©´, loginí•˜ë©´ì„œ postStoreì˜ dataë„ ê°™ì´ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹¤.

ë§Œì•½ ë¹„ë™ê¸°ê°€ ì•„ë‹ˆë¼ ë™ê¸°ì ìœ¼ë¡œ ë‘˜ ë‹¤ ë°”ê¾¸ê³  ì‹¶ì„ ë•Œ.

**ë™ê¸°ì—¬ë„ ë¹„ë™ê¸° ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.**

```javascript

const loginRequest = (data) =>{
  return {
    type: LOG_IN_REQUEST,
    data,
  }
}
const loginSuccess = (data) =>{
  return {
    type: LOG_IN_SUCCESS,
    data,
  }
}
```

ì´ëŸ°ì‹ì˜ ë™ê¸° ì•¡ì…˜ë“¤ì´ê² ì§€ë§Œ, ë™ê¸°ë¼ë©´ í•˜ë‚˜ì˜ storeë°–ì— ë°”ê¿€ ìˆ˜ ì—†ë‹¤.

ì•„ë˜ì²˜ëŸ¼, ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•œë‹¤. => reduxì˜ ì •í•´ì§„ í‹€ë¡œ ì¸í•œ ë‹¨ì .

```jsx
const changeGG = () =>{
  return (dispatch, getState) => {
    dispatch(changeUserStore());
    dispatch(changePostStore());
  }
}
```

>  â— ë¦¬ë•ìŠ¤ì˜ ë‹¨ì 
>
> ë‹¤ì‹œ ì‚´í´ë³´ìë©´, ìœ„ì˜ í˜•íƒœëŠ” ì—„ë°€íˆ ë”°ì§€ìë©´, í•˜ë‚˜ì˜ ìŠ¤í† ì–´ë¥¼ ë°”ê¾¸ëŠ” 2ê°€ì§€ ì•¡ì…˜ì´ ë™ì‘í•˜ëŠ” ê²ƒì´ë‹¤. 
>
> ë¦¬ë•ìŠ¤ì˜ ë‹¨ì  : **í•˜ë‚˜ì˜ ì•¡ì…˜ì´ í•˜ë‚˜ì˜ ìŠ¤í† ì–´ë°–ì— ë°”ê¾¸ì§€ ëª»í•œë‹¤.**

reduxì™€ mobx ë‘˜ë‹¤ í•œë²ˆì”© ì¨ë³´ê³ , ì·¨í–¥ì— ë§ëŠ” ê²ƒì„ ì‚¬ìš©.





## 05-05. ì—„ê²©ëª¨ë“œì™€ ê¸°íƒ€ ê¸°ëŠ¥ë“¤

mobxì— `configure`ë¼ê³  ìˆë‹¤.

[ğŸ“˜ MobX ê³µì‹ë¬¸ì„œ Configuration](https://mobx.js.org/configuration.html)



enforceActionsì˜ ê°’ìœ¼ë¡œëŠ” always, never, strict, ...

```jsx
configure({enforceActions: 'strict'})
```

alwaysë¡œ ì£¼ê²Œ ë˜ë©´, ì¡°ê¸ˆ ì—„ê²©í•´ì§„ë‹¤. => ex) ê°’ì„ ë°”ê¿€ë•Œ ë¬´ì¡°ê±´ Actionìœ¼ë¡œ ê°ì‹¸ ì£¼ì–´ì•¼ í•œë‹¤. 

ì´ëŸ° ì˜µì…˜ì„ ì™œ ì“°ëŠ”ê°€? => mobxê°€ ë„ˆë¬´ ììœ ë¡­ê¸° ë•Œë¬¸ì— ì¡°ê¸ˆ ì œí•œì„ ë‘ê¸° ìœ„í•´.

```jsx
onChangeName(e)=>{
  state.name = e.target.value;
}
//------------------------------------------
configure({enforceActions: 'always'})

onChangeName(e){
  runInAction(()=>{
    state.name = e.target.value;
  })
}
//------------------------------------------
// ë˜ëŠ” í•¨ìˆ˜ìì²´ë¥¼ actionìœ¼ë¡œ ê°ì‹¸ë„ ëœë‹¤.
onChangeName: action((e)=>{
  state.name = e.target.value
})
```

actionìœ¼ë¡œ ê°ìŒ€ë•ŒëŠ” `this`ë¥¼ ì“°ë©´ ì—ëŸ¬ê°€ë‚œë‹¤. => stateê°€ undefinedë¡œ errorë°œìƒ.<br/>(thisë¥¼ ì“°ê³  ì‹¶ìœ¼ë©´, í™”ì‚´í‘œí•¨ìˆ˜ ëŒ€ì‹  ì¼ë°˜ function() {}ì„ ì“°ë©´ ì‚¬ìš©ê°€ëŠ¥.)

êµ³ì´ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ í° ë¬¸ì œëŠ” ë°œìƒ Xì§€ë§Œ, ì—„ê²©í•˜ê²Œ í•˜ê³ ì‹¶ì„ë•Œ ì‚¬ìš©.



Q. useStateì™€ useLocalStoreì°¨ì´

A. useStateëŠ” ê¸°ì¡´ ì²˜ëŸ¼ ë¶ˆë³€ì„±ì„ ì§€ì¼œì•¼ í•˜ê³ , useLocalStoreë¥¼ ì“°ë©´ ë°”ë¡œ ê°’ ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤.<br/>ì¢€ ë” í¸ë¦¬

ì¶”ê°€ì ìœ¼ë¡œ.

```jsx
const [value, setValue] = useState({
  ...
})
```

ì›ì‹œê°’ì´ë©´ `setValue(ë³€ê²½ê°’)`í•˜ë©´ ë¶ˆë³€ì„±ì´ ì§€ì¼œì§€ì§€ë§Œ, ìœ„ ì²˜ëŸ¼ ê°’ì´ ê°ì²´ì¸ ê²½ìš°

```jsx
setValue((prevState)=>{
  ...prevState,
  
})
```

ìœ„ì²˜ëŸ¼ ë¶ˆë³€ì„±ì„ ì§€ì¼œì£¼ì–´ì•¼ í•˜ëŠ”ê²Œ ë²ˆê±°ë¡­ë‹¤.



### useAsObservableSource

Observableì´ ì•„ë‹Œ ì• ë“¤ì„ Observableì²˜ëŸ¼ ë§Œë“¤ì–´ì£¼ëŠ” ë©”ì„œë“œ.

ex) props

ë¶€ëª¨ê°€ ë„˜ê²¨ì£¼ë¯€ë¡œ Observableì¸ì§€ ì•„ë‹Œì§€ ëª¨ë¥¸ë‹¤.

```jsx
import {useAsObservableSource} from 'mobx-react';

const PersonSource = ({name, age})=>{
  const person = useAsObservableSource({name, age});
  return <PersonBanner person={person} />
}
```



### Distructoring

â— Observableì€ ë””ìŠ¤íŠ¸ëŸ­ì³ë§ í•˜ë©´ ì•ˆëœë‹¤.

```jsx
const App = () =>{
  const {isLoggingIn} = useStore; // X
  isLggingIn = false;  // X
  
  useStore.isLoggingIn = false // O
  ...
}
```

ê°ì²´ê¹Œì§€ëŠ” Observableì´ ìœ ì§€ë˜ëŠ”ë° ì›ì‹œê°’ë‹¨ìœ„ë¡œ ë””ìŠ¤íŠ¸ëŸ­ì²˜ë§í•˜ê²Œ ë˜ë©´, ê¹¨ì§€ê²Œ ëœë‹¤.

ìœ„ì²˜ëŸ¼ í•˜ê²Œ ë˜ë©´, ê°’ì„ ë°”ê¾¸ë©´ ë¦¬ëœë”ë§ ì•ˆë¨.

(computedë„ ì•Œì•„ë³´ê¸°)



## 05-06. computedì™€ MobX@6

ì´ì „ê¹Œì§€ëŠ” mobx5ë¡œ í•˜ì˜€ëŠ”ë° computedì™€ MobX6ì—ì„œ ì–´ë–¤ê²Œ ë°”ë€Œì—ˆëŠ”ì§€ ì•Œì•„ë³´ì.



### computed

ë§Œì•½ ì–´ë–¤ ë°°ì—´ì˜ ì—°ì‚°ì„ í•˜ì—¬ ê°’ì„ ëœë”ë§ í•˜ëŠ” ê²½ìš°.

ë¦¬ëœë”ë§ í• ë•Œë§ˆë‹¤ ì—°ì‚°ì´ ì¼ì–´ë‚˜ê²Œ ë  ê²ƒì´ë‹¤.

```jsx
...
class App extends Component {
...
  render() {
    return (
      ...
        <div>{postStore.data.length}</div>
      ...
    );
  }
}

export default observer(App);
```

postStoreì˜ dataë§Œ ë°”ë€”ë•Œ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ì§€ ì•Šê³ , userStoreì˜ data ì¦‰, ë‹¤ë¥¸ ì™¸ë¶€ ìš”ì¸ë“¤ì´ ë°”ë€Œì–´ë„ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚œë‹¤.

ê·¸ë˜ì„œ ì™¸ë¶€ìš”ì¸ë“¤ì— ì˜í•´ ê³„ì† ì—°ì‚°ì´ ì¼ì–´ë‚˜ë©´ í™”ë©´ì´ ëŠë ¤ ì§ˆ ìˆ˜ ìˆë‹¤.

ì´ë¥¼ ìœ„í•´ mobxì—ì„œ ìºì‹±ë°©ë²•ì„ ì œê³µí•˜ëŠ”ë° ê·¸ê²ƒì´ **computed**ë‹¤.



storeì—ì„œ computedë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

getì´ ë¶™ì€ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì£¼ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ **getter**ë¼ê³  í•œë‹¤.

```javascript
// store.js
const postStore = observable({
  data: [],
  addPost(data) {
    this.data.push(data);
  },
  get postLength() {
    return this.data.length;
  },
});
```

ì ‘ê·¼í• ë•ŒëŠ” ì¼ë°˜ ì†ì„±ì²˜ëŸ¼ ì ‘ê·¼í•˜ëŠ”ë°, ì ‘ê·¼í•˜ë©´ í•¨ìˆ˜ì²˜ëŸ¼ ë™ì‘í•œë‹¤.

ë°˜ëŒ€ë¡œ **setter**ë„ ìˆë‹¤.

```jsx
set post(value){
  this.data = value;
}

// postStore.post = value;
```

Lengthì— í•­ìƒ ê°’ì„ ê³„ì‚°í•´ ë†“ê³ , dataê°€ ë°”ë€Œë©´, postLengthê°€ ë°”ë€ë‹¤.

ì¦‰, ì˜ì¡´ëœê²Œ ë°”ë€Œê¸° ì „ì—ëŠ” ìºì‹±í•´ë‘”ë‹¤.

```jsx
// App.jsx
...
const App = () => {
...
  return (
   ...
      <div>{postStore.postLength}</div>
   ...
  );
};

export default observer(App);
```

computedë¥¼ ì“°ê²Œ ë˜ë©´, userStoreê°€ ë°”ë€Œì–´ë„ ë‹¤ì‹œ ë¦¬ë Œë”ë§ ë  ë•Œ ìºì‹±ëœ postLengthë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¨ë‹¤.

ì—°ì‚°ì´ ë³µì¡í•œ ê²ƒë“¤ì€ computedë¡œ ë§Œë“¤ì–´ ë†“ìœ¼ë©´ ê°’ì´ ìºì‹±ë˜ê³ , ì˜ì¡´ì„±ì´ ìˆëŠ” ê²ƒì´ ìˆ˜ì •ë  ë•Œ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ëœë‹¤. 



ë¡œê·¸ì¸ì„ ëˆ„ë¥¼ ë•Œ ë§ˆë‹¤ `strict modeì¼ë•Œ actionì„ ì¨ì•¼ë§Œ ê°’ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤`ëŠ” ê²½ê³ ê°€ ì¶œë ¥ëœë‹¤.

```javascript
const postStore = observable({
  data: [],
  addPost(data) {
    this.data.push(data);
  },
  get postLength() {
    return this.data.length;
  },
});
```

ìœ„ ì²˜ëŸ¼ observableì•ˆì— ì„ ì–¸í•œ í•¨ìˆ˜ëŠ” ìë™ìœ¼ë¡œ actionì´ ë¶™ëŠ”ë‹¤.

```javascript
const userStore = observable({
  isLoggingIn: false,
  data: null,
  logIn(data) {
    this.isLoggingIn = true;
    setTimeout(() => {
      this.data = data;
      this.isLoggingIn = false;
      postStore.data.push(1);
    }, 2000);
  },
  logOut() {
    this.data = null;
  },
});
```

logInì•ˆì— setTimeoutì•ˆì˜ í•¨ìˆ˜ê°€ actionì´ ì œëŒ€ë¡œ ì ìš© ì•ˆë¨. => mobxì—ì„œ actionê°€ì ¸ì™€ ê°ì‹¸ì£¼ë©´ í•´ê²°

```jsx
setTimeout(action(() => {
      this.data = data;
      this.isLoggingIn = false;
      postStore.data.push(1);
    }), 2000);
```





###  MobX@6ì—ì„œ ë³€ê²½ì 

**IE ì§€ì›**

MobX@5ì—ì„œëŠ” IE ì§€ì›ì´ ì•ˆë˜ì„œ, IEê°€ í•„ìš”í•œê²½ìš° MobX@4, í•„ìš”ì—†ìœ¼ë©´ MobX@5ë¥¼ ì‚¬ìš©í–ˆì—ˆëŠ”ë° MobX@6ì—ì„œ ë‘˜ì„ í•©ì³ IEì§€ì›ì„ í•  ìˆ˜ê°€ ìˆë‹¤.

ëŒ€ì‹  configureì—ì„œ proxyìµœì‹  ë¬¸ë²•ì„ ë„ë„ë¡ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.



**useLocalObservable**

useLocalstore => useLocalObservableë¡œ ë³€ê²½ë¨.

```jsx
const App = () => {
  const { userStore, postStore } = useStore();

  const state = useLocalObservable(() => ({
    name: '',
    password: '',
    onChangeName(e) {
      this.name = e.target.value;
    },
    onChangePassword(e) {
      this.password = e.target.value;
    }
  }));
  ...
}
```



**useObserver ë³€ê²½.**

```jsx
return useObserver(
	<div>
  	...
  </div>
)
```

useObserverì„ ê°ì‹¸ì£¼ëŠ”ê²Œ exportì—ì„œ observerë¡œ ê°ì‹¸ì£¼ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½

```jsx
...
export default observer(App);
```



Q. decoratorë¡œ `@observer`í•´ì¤˜ë„ ë˜ì§€ì•Šë‚˜?

A. MobX@6ì—ì„œëŠ” decoratorê°€ ë‹¤ ì‚¬ë¼ì¡Œë‹¤. (classì—ì„œë„ ì‚¬ë¼ì§)

> ì—¬ë‹´
>
> decoratorê°€ ê²°êµ­ í‘œì¤€ì´ ì•„ë‹ˆë¼ì„œ, ì‚¬ëŒë“¤ì´ ì•ˆì“°ë ¤ í•˜ì—¬ ì‚¬ë¼ì§.