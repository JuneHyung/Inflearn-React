# 08. ì§€ë¢°ì°¾ê¸°

## 08-01. Context API ì†Œê°œì™€ ì§€ë¢°ì°¾ê¸°

tdë¥¼ dispatchê°€ 3ë²ˆì„ ê±°ì³ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆëŠ”ë°,  Context APIë¥¼ ì‚¬ìš©í•´ ê³ ì³ë³´ì.

ê°€ë¡œ ì„¸ë¡œì…ë ¥ì¹¸ì´ ìˆê³ , ê²½ê³¼ì‹œê°„, ê²°ê³¼ì°½ì„ ë³¼ ìˆ˜ ìˆê²Œ í•  ê²ƒì´ë‹¤.

```jsx
import React, { useReducer } from 'react';
import Table from './Table';

const initialState = {
  tableData:[],
  timer: 0,
  result:'',
}
const reducer=(state, action)=>{
  switch(action.type){
    default:
      return state;
  }
}
const MineSearch = () =>{
  const [state, dispatch] = useReducer(reducer, initialState);
  return(
    <>
      <Form />
      <div>{state.timer}</div>
      <Table></Table>
      <div>{state.result}</div>
    </>
  )
};

export default MineSearch;
```



Formì„ ì‘ì„±í•´ë³´ì

```jsx
import React from 'react';

const Form = () =>{
  const [row, setRow] = useState(10);
  const [cell, setCell] = useState(10);
  const [mine, setMine] = useState(20);

  const onChangeRow = useCallback((e) =>{
    setRow(e.target.value)
  },[])
  const onChangeCell = useCallback((e) =>{
    setCell(e.target.value)
  },[])
  const onChangeMine = useCallback((e) =>{
    setMine(e.target.value)
  },[])

  onClickBtn = useCallback(()=>{

  },[])

  return(
    <div>
      <input type="number" placeholder="ì„¸ë¡œ" value={row} onChange={onChangeRow}/>
      <input type="number" placeholder="ê°€ë¡œ" value={cell} onChange={onChangeCell}/>
      <input type="number" placeholder="ì§€ë¢°" value={mine} onChange={onChangeMine}/>
      <button onClick={onClickBtn}>ì‹œì‘</button>
    </div>
  )
};

export default Form;
```

onClickBtnì— contextAPIê°€ ë“¤ì–´ê°ˆ ê±°ë‹¤.

propsë¡œ dispatchë¡œ ë„˜ê¸°ì§€ ì•Šê³ , contextAPIë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.

contextAPIë¥¼ ì‚¬ìš©í•´ ìì‹ìœ„ì¹˜ì˜ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°”ë¡œ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.





## 08-02. createContextì™€ Provider

createContextë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì¤‘ì—ì„œ dataì— ì ‘ê·¼í•˜ê³  ì‹¶ì€ ì»´í¬ë„ŒíŠ¸ë“¤ì„ Providerë¡œ ë¬¶ì–´ì£¼ì–´ì•¼í•œë‹¤.

```jsx
const TableContext = createContext();

...
return(
    <TableContext.Provider value={{tableData:state.tableData, dispatch}}>
      <Form />
      <div>{state.timer}</div>
      <Table></Table>
      <div>{state.result}</div>
    </TableContext.Provider>
  )
```

Form, Tableì•„ë˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì€ tableDataì™€ dispatchì— ë°”ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œëœë‹¤.

createContextì•ˆì— ì´ˆê¸°ê°’ì„ ë„£ì„ ìˆ˜ ìˆëŠ”ë° ëª¨ì–‘ë§Œ ë§ì¶”ì.

(ë‹¤ë¥¸ ê³³ì—ì„œ ê°€ì ¸ì™€ ì“¸ ìˆ˜ ìˆë„ë¡ export ì‹œì¼œì¤€ë‹¤.)

```jsx
export const TableContext = createContext({
  tableData: [],
  dispatch:()=>{},
});

```



Formì—ì„œ dispatchë¥¼ contextAPIë¥¼ ì´ìš©í•´ ê°€ì ¸ì™€ë³´ì.

```jsx
import { TableContext } from './MineSearch';

const Form = () =>{
...
  // const value = useContext(TableContext);
	{{ dispatch }} = useContext(TableContext)
}
```

value.dispatchë¡œ dispatchì— ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§„ë‹¤. => êµ¬ì¡°ë¶„í•´ë¡œ ìˆ˜ì •í•´ë„ë¨.

>  â— ì¤‘ìš”
>
> contextAPIê°€ ì„±ëŠ¥ìµœì í™”ê°€ ì–´ë ¤ì›€ì´ ìˆë‹¤. 
>
> ê¸°ë³¸ì ì¸ ë¬¸ì œ ì¤‘ í•˜ë‚˜ê°€
>
> ```jsx
> return(
>     <TableContext.Provider value={{tableData:state.tableData, dispatch}}>
>       <Form />
>       <div>{state.timer}</div>
>       <Table></Table>
>       <div>{state.result}</div>
>     </TableContext.Provider>
>   )
> ```
>
> `value={{...}}` ì´ë ‡ê²Œ ì¨ë²„ë¦¬ë©´, MineSearchê°€ ìƒˆë¡œ ë¦¬ë Œë”ë§ ë  ë•Œ ë§ˆë‹¤ `{...}`  ì´ ê°ì²´ê°€ ìƒˆë¡œ ìƒê¸´ë‹¤.
>
> ê°ì²´ê°€ ìƒˆë¡œìƒì„±ë˜ì„œ ìì‹ë“¤ë„ ìƒˆë¡œ ë¦¬ëœë”ë§ ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸
>
> ê·¸ë˜ì„œ ìºì‹±ì„ í•´ì£¼ì–´ì•¼í•œë‹¤ => useMemo ì´ìš©
>
> ```jsx
> const value = usememo(()=>({tableData: state.tableData, dispatch}), [state.tableData]);
> return(
>     <TableContext.Provider value={value}>
>       <Form />
>       <div>{state.timer}</div>
>       <Table></Table>
>       <div>{state.result}</div>
>     </TableContext.Provider>
>   )
> ```

Formì˜ onClickBtnì„ ì™„ì„±í•´ë³´ì.

```jsx
 onClickBtn = useCallback(()=>{
    dispatch({type: START_GAME, row, cell, mine})
  }, [row, cell, mine])
```

reducer ì‘ì„±.

plantMineì€ onClickBtnìœ¼ë¡œ ë„˜ê¸´ row, cell, mineìœ¼ë¡œ 2ì°¨ì› ë°°ì—´ì„ ë§Œë“¤ í•¨ìˆ˜ì´ë‹¤.

```jsx
const reducer=(state, action)=>{
  switch(action.type){
    case START_GAME:
      return {
        ...state,
        tableData: plantMine(action.row ,action.cell, action.mine)
      }
    default:
      return state;
  }
}
```

ë°°ì—´ì— ì‚¬ìš©í•  ì½”ë“œ

```jsx
export const CODE = {
  MINE: -7,
  NORMAL: -1,
  QUESTION: -2, // ë¬¼ìŒí‘œ
  FLAG: -3, // ê¹ƒë°œ
  QUESTION_MINE: -4, // ë¬¼ìŒí‘œì¸ë° ì§€ë¢°
  FLAG_MINE: -5, // ê¹ƒë°œì¸ë° ì§€ë¢°
  CLICKED_MINE: -6, // í´ë¦­í–ˆëŠ”ë° ì§€ë¢°
  OPENED: 0, // 0ì´ìƒì´ë©´ opened
}
```



## 08-03. useContext ì‚¬ìš©í•´ ì§€ë¢°ì¹¸ ë Œë”ë§

plantMineì„ êµ¬í˜„.

```jsx
const plantMine = (row, cell, mine) => {
  console.log(row, cell, mine)
  const candidate = Array(row*cell).fill().map((arr,i)=>{
    return i;
  })
  const shuffle =[];
  while(candidate.length > row*cell - mine){
    const chosen = candidate.splice(Math.floor(Math.random()*candidate.length), 1)[0];
    shuffle.push(chosen);
  }
  const data = [];
  for(let i=0;i<row;i++){
    const rowData = [];
    data.push(rowData);
    for(let j=0;j<cell;j++){
      rowData.push(CODE.NORMAL);
    }
  }

  for(let k=0;k<shuffle.length;k++){ // ì§€ë¢° ì‹¬ê¸°
    const ver = Math.floor(shuffle[k]/cell);
    const hor = shuffle[k] % cell;
    data[ver][hor] = CODE.MINE;
  }

  return data;
}
```



ì´ì œ í™”ë©´ì„ ê·¸ë¦¬ë©´ ë˜ëŠ”ë°, tableDataë¥¼ ê° ì…€ë“¤ì—ì„œ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.

contextAPIë¥¼ ì‚¬ìš©í•´ ì•„ë˜ì—ì„œ useContextë¡œ ì ‘ê·¼ê°€ëŠ¥.

```jsx
// Table.jsx
import React from 'react';
import Tr from './Tr';
import { TableContext } from './MineSearch';

const Table = () =>{
  const {tableData} = useContext(TableContext);
  return(
    <table>
      {Array(tableData.length).fill().map((tr, i) => <Tr key={i} />)}
    </table>
  )
};

export default Table;

// Tr.jsx
import React from 'react';
import Td from './Td';

const Tr = () =>{
  const {tableData} = useContext(TableContext);
  return(
    <tr>
      {tableData[0] && Array(tableData[0].length).fill().map((td, i) =>
        <Td key={i} />
      )}
    </tr>
  )
};

export default Tr;
```

ì§€ë¢°ë¥¼ ê·¸ë ¤ì£¼ê¸° ìœ„í•´ Tableì—ì„œ iì™€ Trì—ì„œ ië¥¼ Tdê¹Œì§€ ë„˜ê²¨ì£¼ì.

```jsx
// Td.jsx
import React, {useContext} from 'react';
import { TableContext } from './MineSearch';

const Td = ({rowIndex, cellIndex}) =>{
  const {tableData} = useContext(TableContext);
  return(
    <td>{tableData[rowIndex][cellIndex]}</td>
  )
};

export default Td;
```

![draw_table](./readme_images/08_draw_table.png)



styleì„ ì…í˜€ë³´ì.

return ë¶€ë¶„ì˜ tdì²˜ëŸ¼ ì‚¬ìš©í•´ textì— ë”°ë¼ ìŠ¤íƒ€ì¼ì„ ì…í ìˆ˜ ìˆë‹¤.

```jsx
import React, {useContext} from 'react';
import { TableContext } from './MineSearch';

const getTdStyle = (code) =>{
  switch (code) {
    case CODE.NORMAL: case CODE.MINE:
      return {background: '#444' ,color:'#fff'};
    case CODE.OPENED:
      return {background: '#FFF'};
    default:
      return{background: '#FFF'};
  }
}
const getTdText = (code) =>{
  switch(code){
    case CODE.NORMAL:
      return '';
    case CODE.MINE:
      return 'X';
    default:
      return;
  }
}

const Td = ({rowIndex, cellIndex}) =>{
  const {tableData} = useContext(TableContext);
  return(
    <td
    style={getTdStyle(tableData[rowIndex][cellIndex])}
    >{getTdText(tableData[rowIndex][cellIndex])}</td>
  )
};

export default Td;
```





## 08-04. ì™¼ìª½ ì˜¤ë¥¸ìª½ í´ë¦­ ë¡œì§ ì‘ì„±í•˜ê¸°

í´ë¦­í–ˆì„ ë–„ ì¹¸ì„ ì—¬ëŠ” ì½”ë“œë¥¼ ì¶”ê°€.

ë¨¼ì €, reducerì— OPEN_CELLì¶”ê°€

```jsx
const reducer=(state, action)=>{
  switch(action.type){
    case START_GAME:
      return {
        ...state,
        tableData: plantMine(action.row ,action.cell, action.mine)
      }
    case OPEN_CELL:
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      tableData[action.row][action.cell] = CODE.OPENED;
      
      return {
        ...state,
        tableData,
      }
    default:
      return state;
  }
}
```

ê·¸ í›„ Tdì—ì„œ dispatch

```jsx
const Td = ({rowIndex, cellIndex}) =>{
  const {tableData, dispatch} = useContext(TableContext);
  const onClickTd = useCallback(()=>{
      dispatch({type:OPEN_CELL, row: rowIndex, cell:cellIndex});
  })
  return(
    <td
    style={getTdStyle(tableData[rowIndex][cellIndex])}
    onClick={onClickTd}
    >{getTdText(tableData[rowIndex][cellIndex])}</td>
  )
};
```



ì§€ë¢°ì¸ ê²½ìš°ë„ ëª¨ë‘ ë°”ë€Œë‹ˆ onClicTdì—ì„œ ë¶„ê¸°ì²˜ë¦¬ë¥¼ í•´ì£¼ì.

```jsx
import React, { useCallback, useContext } from "react";
import { CODE, OPEN_CELL, TableContext } from "./MineSearch";

const getTdStyle = (code) => {
  switch (code) {
    case CODE.NORMAL:
    case CODE.MINE:
      return { background: "#444", color: "#fff" };
    case CODE.OPENED:
      return { background: "#FFF" };
    case CODE.FLAG_MINE:
    case CODE.FLAG:
      return { background: "#FF0000" };
    case CODE.QUESTION_MINE:
    case CODE.QUESTION:
      return { background: "#FFFF00" };
    default:
      return { background: "#FFF" };
  }
};
const getTdText = (code) => {
  switch (code) {
    case CODE.NORMAL:
      return "";
    case CODE.MINE:
      return "X";
    case CODE.CLICKED_MINE:
      return "í‘";
    case CODE.FLAG_MINE:
    case CODE.FLAG:
      return "ğŸš©";
    case CODE.QUESTION_MINE:
    case CODE.QUESTION:
      return "â“";
    default:
      return;
  }
};

const Td = ({ rowIndex, cellIndex }) => {
  const { tableData, dispatch } = useContext(TableContext);
  const onClickTd = useCallback(() => {
    switch (tableData[rowIndex][cellIndex]) {
      case CODE.OPENED: // ì´ë¯¸ ì—°ì¹¸ì€ íš¨ê³¼X
      case CODE.FLAG_MINE:
      case CODE.FLAG:
      case CODE.QUESTION_MINE:
      case CODE.QUESTION:
        return;
      case CODE.NORMAL: // ë³´í†µ ì¹¸ì€
        dispatch({ type: OPEN_CELL, row: rowIndex, cell: cellIndex });
        return;
      case CODE.MINE:
        dispatch({ type: CLICK_MINE, row: rowIndex, cell: cellIndex });
        return;
    }
  });
  return (
    <td style={getTdStyle(tableData[rowIndex][cellIndex])} onClick={onClickTd}>
      {getTdText(tableData[rowIndex][cellIndex])}
    </td>
  );
};

export default Td;

```



onContextMenuì´ë²¤íŠ¸ë¥¼ í†µí•´ ìš°í´ë¦­ ì²˜ë¦¬.

```jsx
const onRightClickTd = useCallback((e)=>{
    e.preventDefault();
    switch(tableData[rowIndex][cellIndex]){
      case CODE.NORMAL:
      case CODE.MINE:
        dispatch({type: FLAG_CELL, row: rowIndex, cell: cellIndex})
        break;
      case CODE.FLAG_MINE:
      case CODE.FLAG:
        dispatch({type: QUESTION_CELL, row: rowIndex, cell: cellIndex})
        return;
      case CODE.QUESTION_MINE:
      case CODE.QUESTION:
        dispatch({type: NORMALIZE_CELL, row: rowIndex, cell: cellIndex})
        return;
      default:return;
    }
```



## 08-05. ì§€ë¢° ê°œìˆ˜ í‘œì‹œí•˜ê¸°

ë¹ˆ ì¹¸ì„ ëˆŒë €ì„ ë•Œ ì§€ë¢°ê°œìˆ˜ë¥¼ í‘œì‹œí•´ë³´ì.\

OPEN_CELLì—ì„œ êµ¬í˜„. ì£¼ë³€ 8ì¹¸ ê²€ì‚¬. (ë²”ìœ„ ì˜ ì§€ì •í•´ì•¼ í•œë‹¤.)

```jsx
// MineSearch.jsx
case OPEN_CELL: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      // tableData[action.row][action.cell] = CODE.OPENED;
      let around = [];

      if (tableData[action.row - 1]) {
        // ìœ— ì¤„
        around = around.concat(tableData[action.row - 1][action.cell - 1], tableData[action.row - 1][action.cell], tableData[action.row - 1][action.cell + 1]);
      }
      around = around.concat(tableData[action.row][action.cell - 1], tableData[action.row][action.cell + 1]);
      if (tableData[action.row + 1]) {
        // ì•„ë« ì¤„
        around = around.concat(tableData[action.row + 1][action.cell - 1], tableData[action.row + 1][action.cell], tableData[action.row + 1][action.cell + 1]);
      }
      const count = around.filter((v) => [CODE.MINE, CODE.FLAG_MINE, CODE.QUESTION_MINE].includes(v)).length;
      tableData[action.row][action.cell] = count;
      return {
        ...state,
        tableData,
      };
    }
```

ìˆ«ìí‘œì‹œë¥¼ ìœ„í•´ Tdì—ì„œ defaultì— codeë¥¼ ë„£ì–´ì¤€ë‹¤.

0ì¸ê²½ìš°ëŠ” ë¹ˆ ë¬¸ìì—´ í‘œì‹œ

```jsx
const getTdText = (code) => {
  switch (code) {
    case CODE.NORMAL:
      return "";
    case CODE.MINE:
      return "X";
    case CODE.CLICKED_MINE:
      return "í‘";
    case CODE.FLAG_MINE:
    case CODE.FLAG:
      return "â—";
    case CODE.QUESTION_MINE:
    case CODE.QUESTION:
      return "â“";
    default:
      return code || '';
  }
};
```



## 08-06. ë¹ˆ ì¹¸ë“¤ í•œ ë²ˆì— ì—´ê¸°

ì£¼ë³€ ì¹¸ë“¤ì´ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ì£¼ë³€ ì¹¸ë“¤ì„ opení•  ê²ƒì´ë‹¤. => ì¬ê·€

í´ë¦­í•œ ì¹¸ë§Œ ìƒˆë¡œìš´ ê°ì²´ë¡œ ë§Œë“¤ì–´ ì¤¬ëŠ”ë° ì˜†ì¹¸ë“¤ë„ ì—´ì–´ì¤˜ì•¼ëŒ€ì„œ ì¬ê·€ë¥¼ ëŒë©´ì„œ ë¶ˆë³€ì„±ì´ ì•ˆì§€ì¼œì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ëª¨ë“  ì¹¸ë“¤ì„ ìƒˆë¡œìš´ ê°ì²´ë¡œ ë§Œë“¤ì–´ ì¤„ ê²ƒì´ë‹¤.

```jsx
case OPEN_CELL: {
      const tableData = [...state.tableData];
      // tableData[action.row] = [...state.tableData[action.row]];
      // tableData[action.row][action.cell] = CODE.OPENED;
      tableData.forEach((row, i)=>{
        tableData[i] = [...state.tableData[i]]
      })
      const checkedAround = (row, cell) =>{
        let around = [];
        // ì£¼ë³€ì¹¸ë“¤ì˜ ì§€ë¢° ê°œìˆ˜ë¥¼ ê²€ì‚¬
        if (tableData[row - 1]) {
          // ìœ— ì¤„
          around = around.concat(tableData[row - 1][cell - 1], tableData[row - 1][cell], tableData[row - 1][cell + 1]);
        }
        around = around.concat(tableData[row][cell - 1], tableData[row][cell + 1]);
        if (tableData[row + 1]) {
          // ì•„ë« ì¤„
          around = around.concat(tableData[row + 1][cell - 1], tableData[row + 1][action.cell], tableData[row + 1][cell + 1]);
        }
        const count = around.filter((v) => [CODE.MINE, CODE.FLAG_MINE, CODE.QUESTION_MINE].includes(v)).length;
        tableData[row][cell] = count;

        if(count ===0) {
          const near = [];
          if(row-1 >-1) {
            near.push([row-1, cell-1]);
            near.push([row-1, cell]);
            near.push([row-1, cell+1]);
          }
          near.push([row, cell-1]);
          near.push([row, cell+1]);
          if(row+1 >tableData.length) {
            near.push([row+1, cell-1]);
            near.push([row+1, cell]);
            near.push([row+1, cell+1]);
          }
          near.forEach((n)=>{ // ìˆëŠ” ì¹¸ë“¤ë§Œ
            checkedAround(n[0], n[1]);
          })
        }else{

        }
      }
      checkedAround(action.row, action.cell);
      return {
        ...state,
        tableData,
      };
    }
```

ì˜ˆì™¸ ì¶”ê°€

```jsx
 const checkedAround = (row, cell) =>{
        if([CODE.OPENED, CODE.FLAG_MINE, CODE.FLAG, CODE.QUESTION_MINE, CODE.QUESTION].includes(tableData[row][cell])){
          return;
        }
        if(row < 0 || row > tableData.length || cell <0 || cell>tableData[0].length){
          return;
        }

        let around = [];
        // ì£¼ë³€ì¹¸ë“¤ì˜ ì§€ë¢° ê°œìˆ˜ë¥¼ ê²€ì‚¬
        if (tableData[row - 1]) {
          // ìœ— ì¤„
            ...
        }            
}
```



ì§€ê¸ˆ ì½”ë“œë¡œëŠ” ë¬´í•œë°˜ë³µì´ ë°œìƒí•œë‹¤. (0,0í´ë¦­í•˜ë©´ 0,1ë¡œ ì´ë™í•˜ê³ , 0,1ì—ì„œ ë‹¤ì‹œ 0,0ì„ ê²€ì‚¬í•˜ê³ , ...)

í•œ ë²ˆ ì—°ì¹¸ì€ ë‹¤ì‹œ ê²€ì‚¬ ì•Šë„ë¡ ìºì‹±. 

```jsx
...
const checkedAround = (row, cell) =>{
    ...
    const checked = [];
    if(checked.includes(`${row},${cell}`)){return;}
    else {checked.push(`${row},${cell}`)}
}
```

**ì „ì²´ ì½”ë“œ**

```jsx

case OPEN_CELL: {
    const tableData = [...state.tableData];
    // tableData[action.row] = [...state.tableData[action.row]];
    // tableData[action.row][action.cell] = CODE.OPENED;
    tableData.forEach((row, i)=>{
        tableData[i] = [...row]
    })
    const checked = [];
    const checkedAround = (row, cell) =>{
        if([CODE.OPENED, CODE.FLAG_MINE, CODE.FLAG, CODE.QUESTION_MINE, CODE.QUESTION].includes(tableData[row][cell])){
            return;
        }
        if(row < 0 || row >= tableData.length || cell <0 || cell>=tableData[0].length){
            return;
        }
        if(checked.includes(`${row},${cell}`)){return;}
        else {checked.push(`${row},${cell}`)}
        let around = [
            tableData[row][cell-1], tableData[row][cell+1]
        ];
        // ì£¼ë³€ì¹¸ë“¤ì˜ ì§€ë¢° ê°œìˆ˜ë¥¼ ê²€ì‚¬
        if (tableData[row - 1]) {
            // ìœ— ì¤„
            around = around.concat([tableData[row - 1][cell - 1], tableData[row - 1][cell], tableData[row - 1][cell + 1]]);
        }
        around = around.concat(tableData[row][cell - 1], tableData[row][cell + 1]);
        if (tableData[row + 1]) {
            // ì•„ë« ì¤„
            around = around.concat([tableData[row + 1][cell - 1], tableData[row + 1][cell], tableData[row + 1][cell + 1]]);
        }
        const count = around.filter(function (v) {
            return [CODE.MINE, CODE.FLAG_MINE, CODE.QUESTION_MINE].includes(v);
        }).length;

        tableData[row][cell] = count;

        if(count ===0) {
            const near = [];
            if(row-1 >-1) {
                near.push([row-1, cell-1]);
                near.push([row-1, cell]);
                near.push([row-1, cell+1]);
            }
            near.push([row, cell-1]);
            near.push([row, cell+1]);
            if(row+1 <tableData.length) {
                near.push([row+1, cell-1]);
                near.push([row+1, cell]);
                near.push([row+1, cell+1]);
            }
            near.forEach((n)=>{ // ìˆëŠ” ì¹¸ë“¤ë§Œ
                if(tableData[n[0]][n[1]] !== CODE.OPENED){
                    checkedAround(n[0], n[1]);
                }
            })
        }
    }
    checkedAround(action.row, action.cell);
    return {
        ...state,
        tableData,
    };
}
```





## 08-07. ìŠ¹ë¦¬ ì¡°ê±´ ì²´í¬ì™€ íƒ€ì´ë¨¸

ë§ˆì§€ë§‰ìœ¼ë¡œ ìŠ¹ë¦¬ì¡°ê±´ê³¼ ì²´í¬ íƒ€ì´ë¨¸ë¥¼ êµ¬í˜„

ìŠ¹ë¦¬ì¡°ê±´ : row*cell -mineìˆ˜ ë§Œí¼ì´ë©´ ìŠ¹ë¦¬.

OPEN_CELLì—ì„œ countë¥¼ í•´ì£¼ì. ì¹¸ì„ ì—´ë•Œë§ˆë‹¤ 1ì”©ì¦ê°€.

```jsx
case OPEN_CELL: {
    ...
    let openedCount = 0;
    const checkedAround = (row, cell) =>{
        ...
        openedCount+=1;
    }
```

ìŠ¹ë¦¬ì‹œ haltedì™€ resultê°’ ë³€ê²½.

ì´ë¥¼ ìœ„í•´ stateì— dataë¡œ row,cell mineì •ë³´ë¥¼ ì¶”ê°€í•˜ê³ , opendCountë¥¼ ì¶”ê°€í•¨.

ì •ì§€flag haltedì¶”ê°€.

```jsx
const initialState = {
  tableData: [],
  data: {
    row: 0,
    cell: 0,
    mine: 0,
  },
  timer: 0,
  result: "",
  halted: false,
  openedCount: 0,
};
...
const checkedAround = (row, cell) =>{
...
        openedCount+=1;
...
      checkedAround(action.row, action.cell);
      let halted = false;
      let result = '';
      if(state.data.row * state.data.cell - state.data.mine === state.openedCount + openedCount){//ìŠ¹ë¦¬
        halted = true;
        result = 'ìŠ¹ë¦¬í•˜ì…¨ìŠµë‹ˆë‹¤';
      }

      return {
        ...state,
        tableData,
        openedCount: state.openedCount + openedCount,
        halted,
        result,
      };
    }
```



1ì´ˆì”© ì¦ê°€í•˜ëŠ” íƒ€ì´ë¨¸.

```jsx

const reducer = (state, action) => {
  switch (action.type) {
          ...
      case INCREMENT_TIMER: {
          return {
              ...state,
              timer: state.timer+1
          }
      }
  }
}

const MineSearch = () => {
...
  useEffect(()=>{
    const timer = setInterval(()=>{
      dispatch({type:INCREMENT_TIMER})
    }, 1000);
    return ()=>{
      clearInterval(timer)
    }
  })
...
};

```



ì‹œì‘ì„ ëˆŒë €ì„ ë•Œ ë¶€í„° ì´ˆê°€ ì¦ê°€í•´ì•¼í•œë‹¤.

haltedë¡œ ë¶„ê¸°.

```jsx
const MineSearch = () => {
  ...
  useEffect(()=>{
    let timer;
    if(!halted){
      timer = setInterval(()=>{
        dispatch({type:INCREMENT_TIMER})
      }, 1000);
    }
    return ()=>{
      clearInterval(timer)
    }
  }, [halted])
}
```



â— bugFix

ìƒˆë¡œ ì—¬ëŠ” ì¹¸ì˜ ì˜ì—­ì— ì´ë¯¸ ì—´ë¦°ì¹¸ì´ì—¬ë„ countë¥¼ í•¨.

codeê°€ normalì¸ ê²½ìš°ë§Œ open

```jsx
if (tableData[row][cell] === CODE.NORMAL) { // ë‚´ ì¹¸ì´ ë‹«íŒ ì¹¸ì´ë©´ ì¹´ìš´íŠ¸ ì¦ê°€
    openedCount += 1;
}
tableData[row][cell] = count;
```





## 08-08. Context API ìµœì í™”

React DevToolsë¥¼ ì—´ì–´ë³´ë©´ ì „ì²´ê°€ ê³„ì† ë°˜ì§ì´ê³  ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.<br/>(timerë•Œë¬¸ìœ¼ë¡œ ì§ì‘ë¨.)



* Providerì— ë“¤ì–´ê°ˆ valueë¥¼ `useMemo`ë¡œ ìºì‹±.
* Formê°™ì€ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ì— memo ì ìš©
  * ì‹œì‘í• ë•Œ ê³„ì† ë°˜ì§ì´ëŠ” í˜„ìƒì€ ì—†ì–´ ì§.

í•˜ì§€ë§Œ í´ë¦­ì‹œ ì „ì²´ê°€ ë¦¬ë Œë”ë§ ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.

=> `useContext`ë¥¼ ì“°ë©´, stateê°€ ë°”ë€”ë•Œ ë§ˆë‹¤ ê¸°ë³¸ì ìœ¼ë¡œ í•œ ë²ˆ ë¦¬ëœë”ë§ì´ ë¨.

Tdì— useMemoë¥¼ ì‚¬ìš©í•´ ì»´í¬ë„ŒíŠ¸ ê°’ì„ ê¸°ì–µí•˜ê²Œ í•˜ì.

```jsx
return useMemo(()=>(
      <td 
        style={getTdStyle(tableData[rowIndex][cellIndex])} 
        onClick={onClickTd}
        onContextMenu={onRightClickTd}
      >
        {getTdText(tableData[rowIndex][cellIndex])}
      </td>
    )
  , [tableData[rowIndex][cellIndex]])
```

getTdTextì™€ ë°–ì— console.logë¥¼ ì°ì–´ë³´ë©´, getTdTextëŠ” í•œë²ˆë§Œ ì¶œë ¥ë˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì¦‰, renderìì²´ëŠ” 1ë²ˆë§Œ í•œë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤.



useMemoê°€ ì‹«ë‹¤ë©´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.

```jsx
...
  return <RealTd onClickTd={onClickTd} onRightClickTd={onRightClickTd} data={tableData[rowIndex][cellIndex]} />;
});

const RealTd = memo(({onClickTd, onRightClickTd, data}) =>{
  return (
    <td 
      style={getTdStyle(data)} 
      onClick={onClickTd}
      onContextMenu={onRightClickTd}
    >
      {getTdText(data)}
    </td>
  )
})

export default Td;

```

